<%page expression_filter="h"/>
<%inherit file="base.html" />
<%!
  from django.utils.translation import ugettext as _
  from django.core.urlresolvers import reverse
  from django.conf import settings
%>
<%block name="title">
  ${_("Course Validation")}
</%block>

<%block name="content">
  <style>
    .mybutton {
      background-color: #2266bb;
      color: #eedd55;
      display: inline-block;
      padding: 15px;
    }

    .passed .highlight {
      color: #11aa44;
    }

    .failed .highlight {
      color: #ff2200;
    }

    .mytable {
      width: 70%;
      border-spacing: 5px;
      text-align: center;
      font-size: 18px;
      margin: 10px;
    }

    .mytable-head {
      font-size: 22px;
    }

    .message {
      font-size: 16px;
    }

    .header {
      font-size: 26px;
    }

    .mypanel {
      border-style: solid;
      border-width: 1px;
    }

  </style>
  <section class="content">
    <div class="introduction">
      <h2 class="title">${_("About Course Validation")}</h2>
      <div>
        <p> ${_("This tool is designed to check course before publishing. Different inspections and checks are being performed and then the report will be formed, shown to you and saved. Perhaps validation will take a little time.")}
        </p>
      </div>

      <h2 class="title">${_("Validation")}</h2>
      <a href="${validate_url}" class="mybutton" title=${_("Execute validation")}>
                    <span>
                      ${_("Validate Course")}
                    </span>
      </a>
    </div>

    <div data-load="${validate_url}">
      <p id="validreport">Replace me</p>

      % if sections:
        % for type_ in sections:
        % if type_['passed']:
          <div class="passed">
        % else:
          <div class="failed">
        % endif
          <div class="mypanel">
            <h2 class="header highlight">${type_['name']}</h2>
            % if type_['output']:
              <table class="mytable">
                <tr class="mytable-head">
                  % for name in type_['head']:
                    <th>${name}</th>
                  % endfor
                </tr>
                % for line in type_['body']:
                  <tr>
                    % for item in line:
                      <td>${item}</td>
                    % endfor
                  </tr>
                % endfor
              </table>
            % endif
            % for warn in type_['warnings']:
              <p class="highlight message">${warn}</p>
            % endfor
          </div>
          </div>
        % endfor
      % endif
    </div>
  </section>

  <script type="text/javascript">
    require(["jquery"], function ($) {
      $(document).ready(function () {
        var dataurl = $("${validate_url}").attr('data-load')

        $(".mybutton").click(function (event) {
          var respfunc = function(data){
                      res = JSON.parse(data)
                      $("#validreport").text(res)
                      }
          $.ajax({
                    url: dataurl,
                    type: "GET",
                    dataType: 'html',
                    success: respfunc
                  })
                });
          return false;
        })
      })
    })
  </script>

</%block>

"""
function (event) {
        var respfunc = function(data){
                      $("#validreport").html(data)
                      }
                  $.ajax({
                    url: dataurl,
                    dataType: 'html',
                    success: respfunc
                  })
                  return false;
                });
"""